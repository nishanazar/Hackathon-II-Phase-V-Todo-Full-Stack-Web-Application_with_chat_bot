# Data Model: Dapr & Kafka Setup on Minikube

## Overview
This document describes the data models and entities relevant to the Dapr & Kafka setup on Minikube. Since this is primarily an infrastructure feature, the data model focuses on the configuration and message structures rather than application data.

## Key Entities

### 1. Dapr Component Configuration
**Entity**: Component configuration for pub/sub
**Fields**:
- `apiVersion`: String (e.g., "dapr.io/v1alpha1")
- `kind`: String (e.g., "Component")
- `metadata.name`: String (unique component identifier)
- `spec.type`: String (component type, e.g., "pubsub.kafka")
- `spec.version`: String (component version)
- `spec.metadata`: Object (key-value pairs for component configuration)

**Relationships**: Used by Dapr runtime to establish connections to message brokers

**Validation rules**:
- Component name must be unique within the namespace
- Component type must be supported by Dapr
- Metadata fields must match the requirements of the specific component type

### 2. Pub/Sub Message
**Entity**: Message structure for pub/sub communication
**Fields**:
- `topic`: String (the topic name, e.g., "task-events")
- `data`: Object (the message payload)
- `datacontenttype`: String (content type of the message, e.g., "application/json")
- `traceid`: String (for distributed tracing)
- `correlationid`: String (for message correlation)

**State transitions**: Published → Delivered → Consumed

**Validation rules**:
- Topic name must exist in the pub/sub component
- Data must be serializable to the specified content type
- Required fields must be present

### 3. Task Event
**Entity**: Specific event type for task-related activities
**Fields**:
- `eventId`: String (unique identifier for the event)
- `eventType`: String (type of task event, e.g., "task.created", "task.updated", "task.deleted")
- `timestamp`: DateTime (when the event occurred)
- `userId`: String (ID of the user associated with the event)
- `taskId`: String (ID of the task involved in the event)
- `payload`: Object (additional data related to the event)

**Relationships**: Related to specific tasks and users in the application

**Validation rules**:
- eventType must be one of the predefined event types
- timestamp must be in ISO 8601 format
- userId and taskId must be valid identifiers

### 4. Dapr Subscription
**Entity**: Defines which endpoints should receive messages from which topics
**Fields**:
- `apiVersion`: String (e.g., "dapr.io/v2alpha1")
- `kind`: String (e.g., "Subscription")
- `metadata.name`: String (subscription identifier)
- `spec.topic`: String (the topic to subscribe to)
- `spec.pubsubname`: String (name of the pubsub component)
- `spec.route`: String (the route to send messages to)
- `spec.metadata`: Object (subscription-specific metadata)

**Relationships**: Links pub/sub components to application endpoints

**Validation rules**:
- Referenced pubsub component must exist
- Route must correspond to a valid application endpoint
- Topic must exist in the referenced pubsub component

## State Transitions

### Task Event Lifecycle
1. **Created**: Event is generated by an application service
2. **Published**: Event is sent to the pub/sub system via Dapr
3. **Queued**: Event waits in the message broker
4. **Delivered**: Event is sent to subscribed consumers
5. **Processed**: Consumer handles the event
6. **Acknowledged**: Consumer confirms successful processing

## Relationships Between Entities

```
Dapr Component Configuration
        ↓ (used by)
Pub/Sub Message
        ↓ (contains)
Task Event
        ↓ (processed by)
Dapr Subscription
```

## Data Flow

1. Application generates a Task Event
2. Application sends the event to Dapr's pub/sub API
3. Dapr routes the message to the configured pub/sub component
4. The message broker (Redpanda/Kafka) stores and manages the message
5. Subscribed services receive the message via Dapr subscription
6. Subscribed services process the Task Event