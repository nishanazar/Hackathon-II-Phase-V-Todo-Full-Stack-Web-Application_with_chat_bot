---
id: "001"
title: "Phase2 Constitution Update"
stage: "constitution"
date: "2026-01-03"
surface: "agent"
model: "Qwen Code"
feature: "phase2-constitution"
branch: "main"
user: "USER"
command: "/sp.constitution ---\nname: phase2-constitution\ndescription: Concise governing rules for Phase II Todo Full-Stack Web App development.\n---\n# Phase II Constitution (Concise)\n\n## Core Principles\n- Spec-driven: All work starts and ends with /specs/\n- No manual coding: Only AI agents (Qwen CLI) edit code\n- Strict user isolation via JWT + DB filtering\n- Stateless JWT auth with shared BETTER_AUTH_SECRET\n\n## Key Standards\n- Monorepo structure exactly as defined (.spec-kit/, specs/, frontend/, backend/)\n- Tech stack fixed: Next.js 16+ App Router • FastAPI • SQLModel • Neon PostgreSQL • Better Auth + JWT\n- All API endpoints: /api/{user_id}/tasks/* with JWT required and user_id matching\n- Specs referenced via @specs/... syntax\n\n## Constraints\n- No tech stack deviations\n- No shared sessions — JWT only\n- All features require spec in /specs/features/ before implementation\n- Schema/API/UI changes must update respective spec files\n\n## Success Criteria\n- Full CRUD web app with responsive UI\n- Perfect multi-user isolation (no cross-user data access)\n- Complete flow: signup → login → manage own tasks → logout\n- JWT verified correctly by backend\n- docker-compose up works with persistent storage\n- All code traceable to specs via agentic workflow\n- Ready for Phase III\n\nDeviations require spec update and explicit approval."
labels: ["constitution", "spec-driven", "full-stack", "jwt-auth"]
links:
  spec: null
  ticket: null
  adr: null
  pr: null
files:
  - ".specify/memory/constitution.md"
  - ".specify/templates/plan-template.md"
  - ".specify/templates/spec-template.md"
  - ".specify/templates/tasks-template.md"
tests: []
outcome: "Successfully updated the project constitution from Phase I (In-Memory Todo Python Console App) to Phase II (Full-Stack Web App with Next.js, FastAPI, SQLModel, Neon PostgreSQL, and JWT authentication). The new constitution establishes core principles around spec-driven development, agentic coding, user isolation, and stateless authentication. Template files were updated to align with the new constitution requirements."
evaluation: "The constitution update was successful. The new constitution clearly defines the requirements for Phase II development, including the tech stack, architecture, and development workflow. All related template files were updated to reflect the new requirements. The version was incremented from 1.0.0 to 2.0.0 to reflect the significant changes in project scope and technology stack."
---

# Phase II Constitution (Concise)

## Core Principles

### I. Spec-driven: All work starts and ends with /specs/
All development work must be based on specifications in the /specs/ directory. No implementation should proceed without a corresponding spec. All changes must be traced back to spec files, and implementation must align with the specifications exactly as written. This ensures consistency and traceability throughout the development process.

### II. No manual coding: Only AI agents (Qwen CLI) edit code
All code must be generated by AI agents, specifically using Qwen CLI tools. Manual coding by humans is strictly prohibited. Any code written directly by humans without AI agent assistance is non-compliant with this constitution. This ensures consistency and adherence to project standards across all code changes.

### III. Strict user isolation via JWT + DB filtering
The application must implement strict user isolation using JWT authentication and database-level filtering. Users must only be able to access their own data. The backend must verify JWT tokens and filter database queries by user ID to ensure no cross-user data access occurs. This is critical for security and privacy compliance.

### IV. Stateless JWT auth with shared BETTER_AUTH_SECRET
Authentication must be stateless using JWT tokens with a shared BETTER_AUTH_SECRET environment variable. The secret must be consistent across all services (frontend and backend) to ensure proper token validation. This enables horizontal scaling and simplifies deployment while maintaining security standards.

## Key Standards

The application must adhere to these technology requirements and architectural standards:
- Monorepo structure exactly as defined (.spec-kit/, specs/, frontend/, backend/)
- Tech stack fixed: Next.js 16+ App Router • FastAPI • SQLModel • Neon PostgreSQL • Better Auth + JWT
- All API endpoints: /api/{user_id}/tasks/* with JWT required and user_id matching
- Specs referenced via @specs/... syntax

## Constraints

The following constraints are non-negotiable and must be strictly adhered to:
- No tech stack deviations
- No shared sessions — JWT only
- All features require spec in /specs/features/ before implementation
- Schema/API/UI changes must update respective spec files

## Success Criteria

The project will be considered successful when it meets these criteria:
- Full CRUD web app with responsive UI
- Perfect multi-user isolation (no cross-user data access)
- Complete flow: signup → login → manage own tasks → logout
- JWT verified correctly by backend
- docker-compose up works with persistent storage
- All code traceable to specs via agentic workflow
- Ready for Phase III

## Governance

This constitution supersedes all other development practices. All pull requests and code reviews must verify compliance with these principles. Deviations from this constitution require explicit spec update and approval by project leadership. Amendments to this constitution require explicit documentation and approval following the same spec-driven process as other project changes.

**Version**: 2.0.0 | **Ratified**: 2025-01-01 | **Last Amended**: 2026-01-03